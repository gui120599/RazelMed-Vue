import{i as H,f as y,v as V,y as U,x as J,c as v,o as m,w as o,b as t,u as e,a as i,e as u,t as g,s as S,j as E,F as A,l as I,W as N,A as B}from"./app-DOt-nZF6.js";import{t as b}from"./index-Dwxs3NNq.js";import{_ as w}from"./index-CxNt7xU9.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-BbxJWnMV.js";import{_ as K,a as Q,b as X,c as Y,d as Z,e as ee}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-L3YQSjYi.js";import{U as se,S as D,_ as F,a as q,b as _,c as p,d as W,e as r,f as te,g as oe}from"./TableHeader.vue_vue_type_script_setup_true_lang-BjTwBViC.js";import"./useForwardExpose-Dgz0452n.js";import"./useForwardPropsEmits-zKkhj9Cp.js";const le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ae={class:"relative mb-4"},ue={class:"h-[400px] overflow-y-auto border rounded-md"},ie={class:"relative mb-4"},ne={class:"h-[400px] overflow-y-auto border rounded-md"},re={class:"flex justify-end gap-2 mt-4"},Ue={__name:"InstitutionUsersDialog",props:{institution:{type:Object,required:!0},open:{type:Boolean,default:!1}},emits:["update:open"],setup(k,{expose:j,emit:z}){const f=k,T=z,O=H(),M=y(()=>O.props.allUsers||[]),n=V(f.open),d=V(""),$=V([]);U(()=>f.open,a=>{n.value=a}),U(n,a=>{T("update:open",a)});const x=()=>{$.value=f.institution.users||[]};U(n,a=>{a&&(x(),d.value="")}),U(()=>f.institution,(a,s)=>{n.value&&x()},{deep:!0});const C=y(()=>{const a=d.value.toLowerCase();return $.value.filter(s=>s.name.toLowerCase().includes(a)||s.email.toLowerCase().includes(a))}),h=y(()=>{const a=new Set($.value.map(l=>l.id)),s=d.value.toLowerCase();return M.value.filter(l=>!a.has(l.id)&&(l.name.toLowerCase().includes(s)||l.email.toLowerCase().includes(s)))}),c=J({user_id:null}),P=a=>{c.user_id=a,c.post(route("institutions.users.attach",f.institution.id),{onSuccess:()=>{b.success("Usuário adicionado com sucesso!"),N.reload({only:["institutions"]}),B(()=>{x()})},onError:s=>{console.error("Erro ao adicionar usuário:",s),b.error("Falha ao adicionar usuário. Verifique o console.")},onFinish:()=>{}})},R=a=>{confirm("Tem certeza que deseja remover este usuário desta instituição?")&&(c.user_id=a,c.delete(route("institutions.users.detach",f.institution.id),{onSuccess:()=>{b.success("Usuário removido com sucesso!"),N.reload({only:["institutions"]}),B(()=>{x()})},onError:s=>{console.error("Erro ao remover usuário:",s),b.error("Falha ao remover usuário. Verifique o console.")}}))};return j({openDialog:()=>{n.value=!0}}),(a,s)=>(m(),v(e(ee),{open:n.value,"onUpdate:open":s[3]||(s[3]=l=>n.value=l)},{default:o(()=>[t(e(K),{"as-child":""},{default:o(()=>[t(e(w),{variant:"outline",size:"sm",title:"PERMISSÕES DE USUÁRIOS"},{default:o(()=>[t(e(se))]),_:1})]),_:1}),t(e(Q),{class:"lg:max-w-[1200px] max-h-[90vh] overflow-y-auto"},{default:o(()=>[t(e(X),null,{default:o(()=>[t(e(Y),null,{default:o(()=>[u("Gerenciar Usuários da Instituição: "+g(k.institution.name),1)]),_:1}),t(e(Z),null,{default:o(()=>s[4]||(s[4]=[u(" Adicione ou remova usuários que têm acesso a esta instituição. ")])),_:1,__:[4]})]),_:1}),i("div",le,[i("div",null,[s[9]||(s[9]=i("h3",{class:"text-lg font-semibold mb-2"},"Usuários Disponíveis (Sem Acesso)",-1)),i("div",ae,[t(e(L),{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=l=>d.value=l),placeholder:"Buscar usuário por nome ou email...",class:"pl-10"},null,8,["modelValue"]),t(e(D),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]),i("div",ue,[t(e(F),null,{default:o(()=>[t(e(q),null,{default:o(()=>[t(e(_),null,{default:o(()=>[t(e(p),null,{default:o(()=>s[5]||(s[5]=[u("Nome")])),_:1,__:[5]}),t(e(p),null,{default:o(()=>s[6]||(s[6]=[u("Email")])),_:1,__:[6]}),t(e(p),{class:"text-right"},{default:o(()=>s[7]||(s[7]=[u("Ação")])),_:1,__:[7]})]),_:1})]),_:1}),t(e(W),null,{default:o(()=>[h.value.length===0?(m(),v(e(_),{key:0},{default:o(()=>[t(e(r),{colspan:"3",class:"text-center text-muted-foreground"},{default:o(()=>s[8]||(s[8]=[u(" Nenhum usuário disponível. ")])),_:1,__:[8]})]),_:1})):S("",!0),(m(!0),E(A,null,I(h.value,l=>(m(),v(e(_),{key:l.id},{default:o(()=>[t(e(r),null,{default:o(()=>[u(g(l.name),1)]),_:2},1024),t(e(r),null,{default:o(()=>[u(g(l.email),1)]),_:2},1024),t(e(r),{class:"text-right"},{default:o(()=>[t(e(w),{variant:"outline",size:"sm",onClick:G=>P(l.id),disabled:e(c).processing},{default:o(()=>[t(e(te),{class:"h-4 w-4 mr-1"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),i("div",null,[s[14]||(s[14]=i("h3",{class:"text-lg font-semibold mb-2"},"Usuários com Acesso à Instituição",-1)),i("div",ie,[t(e(L),{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=l=>d.value=l),placeholder:"Buscar usuário por nome ou email...",class:"pl-10"},null,8,["modelValue"]),t(e(D),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]),i("div",ne,[t(e(F),null,{default:o(()=>[t(e(q),null,{default:o(()=>[t(e(_),null,{default:o(()=>[t(e(p),null,{default:o(()=>s[10]||(s[10]=[u("Nome")])),_:1,__:[10]}),t(e(p),null,{default:o(()=>s[11]||(s[11]=[u("Email")])),_:1,__:[11]}),t(e(p),{class:"text-right"},{default:o(()=>s[12]||(s[12]=[u("Ação")])),_:1,__:[12]})]),_:1})]),_:1}),t(e(W),null,{default:o(()=>[C.value.length===0?(m(),v(e(_),{key:0},{default:o(()=>[t(e(r),{colspan:"3",class:"text-center text-muted-foreground"},{default:o(()=>s[13]||(s[13]=[u(" Nenhum usuário com acesso direto. ")])),_:1,__:[13]})]),_:1})):S("",!0),(m(!0),E(A,null,I(C.value,l=>(m(),v(e(_),{key:l.id},{default:o(()=>[t(e(r),null,{default:o(()=>[u(g(l.name),1)]),_:2},1024),t(e(r),null,{default:o(()=>[u(g(l.email),1)]),_:2},1024),t(e(r),{class:"text-right"},{default:o(()=>[t(e(w),{variant:"destructive",size:"sm",onClick:G=>R(l.id),disabled:e(c).processing},{default:o(()=>[t(e(oe),{class:"h-4 w-4 mr-1"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),i("div",re,[t(e(w),{variant:"outline",onClick:s[2]||(s[2]=l=>n.value=!1)},{default:o(()=>s[15]||(s[15]=[u("Fechar")])),_:1,__:[15]})])]),_:1})]),_:1},8,["open"]))}};export{Ue as default};
