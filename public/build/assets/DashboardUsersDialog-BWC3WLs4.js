import{i as H,f as $,v as y,y as h,x as J,c as v,o as m,w as o,b as a,u as e,a as u,e as r,t as b,s as S,j as E,F as A,l as D,W as N,A as B}from"./app-Ok4sUdtS.js";import{t as x}from"./index-B63Ll-vo.js";import{_ as U}from"./index-8ZH9h2Im.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-DPExSES9.js";import{_ as K,a as Q,b as X,c as Y,d as Z,e as ee}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DAVfuRdv.js";import{U as se,S as F,_ as q,a as I,b as _,c as p,d as W,e as d,f as ae,g as oe}from"./TableHeader.vue_vue_type_script_setup_true_lang-Do55Ca_S.js";import"./useForwardExpose-d_HlJpHD.js";import"./useForwardPropsEmits-BEDIxWjV.js";const te={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},le={class:"relative mb-4"},re={class:"h-[400px] overflow-y-auto border rounded-md"},ue={class:"relative mb-4"},ne={class:"h-[400px] overflow-y-auto border rounded-md"},de={class:"flex justify-end gap-2 mt-4"},he={__name:"DashboardUsersDialog",props:{dashboard:{type:Object,required:!0},open:{type:Boolean,default:!1}},emits:["update:open"],setup(V,{expose:j,emit:z}){const f=V,T=z,O=H(),M=$(()=>O.props.allUsers||[]),n=y(f.open),i=y(""),w=y([]);h(()=>f.open,l=>{n.value=l}),h(n,l=>{T("update:open",l)});const g=()=>{w.value=f.dashboard.users||[]};h(n,l=>{l&&(g(),i.value="")}),h(()=>f.dashboard,(l,s)=>{n.value&&g()},{deep:!0});const k=$(()=>{const l=i.value.toLowerCase();return w.value.filter(s=>s.name.toLowerCase().includes(l)||s.email.toLowerCase().includes(l))}),C=$(()=>{const l=new Set(w.value.map(t=>t.id)),s=i.value.toLowerCase();return M.value.filter(t=>!l.has(t.id)&&(t.name.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)))}),c=J({user_id:null}),P=l=>{c.user_id=l,c.post(route("dashboards.users.attach",f.dashboard.id),{onSuccess:()=>{x.success("Usuário adicionado com sucesso!"),N.reload({only:["dashboards"]}),B(()=>{g()})},onError:s=>{console.error("Erro ao adicionar usuário:",s),x.error("Falha ao adicionar usuário. Verifique o console.")},onFinish:()=>{}})},R=l=>{confirm("Tem certeza que deseja remover este usuário desta instituição?")&&(c.user_id=l,c.delete(route("dashboards.users.detach",f.dashboard.id),{onSuccess:()=>{x.success("Usuário removido com sucesso!"),N.reload({only:["dashboards"]}),B(()=>{g()})},onError:s=>{console.error("Erro ao remover usuário:",s),x.error("Falha ao remover usuário. Verifique o console.")}}))};return j({openDialog:()=>{n.value=!0}}),(l,s)=>(m(),v(e(ee),{open:n.value,"onUpdate:open":s[3]||(s[3]=t=>n.value=t)},{default:o(()=>[a(e(K),{"as-child":""},{default:o(()=>[a(e(U),{variant:"outline",size:"sm",title:"PERMISSÕES DE USUÁRIOS"},{default:o(()=>[a(e(se))]),_:1})]),_:1}),a(e(Q),{class:"lg:max-w-[1200px] max-h-[90vh] overflow-y-auto"},{default:o(()=>[a(e(X),null,{default:o(()=>[a(e(Y),null,{default:o(()=>[r("Gerenciar Usuários da Instituição: "+b(V.dashboard.name),1)]),_:1}),a(e(Z),null,{default:o(()=>s[4]||(s[4]=[r(" Adicione ou remova usuários que têm acesso a esta instituição. ")])),_:1,__:[4]})]),_:1}),u("div",te,[u("div",null,[s[9]||(s[9]=u("h3",{class:"text-lg font-semibold mb-2"},"Usuários Disponíveis (Sem Acesso)",-1)),u("div",le,[a(e(L),{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=t=>i.value=t),placeholder:"Buscar usuário por nome ou email...",class:"pl-10"},null,8,["modelValue"]),a(e(F),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]),u("div",re,[a(e(q),null,{default:o(()=>[a(e(I),null,{default:o(()=>[a(e(_),null,{default:o(()=>[a(e(p),{class:"text-right"},{default:o(()=>s[5]||(s[5]=[r("Ação")])),_:1,__:[5]}),a(e(p),null,{default:o(()=>s[6]||(s[6]=[r("Nome")])),_:1,__:[6]}),a(e(p),null,{default:o(()=>s[7]||(s[7]=[r("Email")])),_:1,__:[7]})]),_:1})]),_:1}),a(e(W),null,{default:o(()=>[C.value.length===0?(m(),v(e(_),{key:0},{default:o(()=>[a(e(d),{colspan:"3",class:"text-center text-muted-foreground"},{default:o(()=>s[8]||(s[8]=[r(" Nenhum usuário disponível. ")])),_:1,__:[8]})]),_:1})):S("",!0),(m(!0),E(A,null,D(C.value,t=>(m(),v(e(_),{key:t.id},{default:o(()=>[a(e(d),{class:"text-right"},{default:o(()=>[a(e(U),{variant:"outline",size:"sm",onClick:G=>P(t.id),disabled:e(c).processing},{default:o(()=>[a(e(ae),{class:"h-4 w-4 mr-1"})]),_:2},1032,["onClick","disabled"])]),_:2},1024),a(e(d),null,{default:o(()=>[r(b(t.name),1)]),_:2},1024),a(e(d),null,{default:o(()=>[r(b(t.email),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),u("div",null,[s[14]||(s[14]=u("h3",{class:"text-lg font-semibold mb-2"},"Usuários com Acesso à Instituição",-1)),u("div",ue,[a(e(L),{modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=t=>i.value=t),placeholder:"Buscar usuário por nome ou email...",class:"pl-10"},null,8,["modelValue"]),a(e(F),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]),u("div",ne,[a(e(q),null,{default:o(()=>[a(e(I),null,{default:o(()=>[a(e(_),null,{default:o(()=>[a(e(p),null,{default:o(()=>s[10]||(s[10]=[r("Nome")])),_:1,__:[10]}),a(e(p),null,{default:o(()=>s[11]||(s[11]=[r("Email")])),_:1,__:[11]}),a(e(p),{class:"text-right"},{default:o(()=>s[12]||(s[12]=[r("Ação")])),_:1,__:[12]})]),_:1})]),_:1}),a(e(W),null,{default:o(()=>[k.value.length===0?(m(),v(e(_),{key:0},{default:o(()=>[a(e(d),{colspan:"3",class:"text-center text-muted-foreground"},{default:o(()=>s[13]||(s[13]=[r(" Nenhum usuário com acesso direto. ")])),_:1,__:[13]})]),_:1})):S("",!0),(m(!0),E(A,null,D(k.value,t=>(m(),v(e(_),{key:t.id},{default:o(()=>[a(e(d),null,{default:o(()=>[r(b(t.name),1)]),_:2},1024),a(e(d),null,{default:o(()=>[r(b(t.email),1)]),_:2},1024),a(e(d),{class:"text-right"},{default:o(()=>[a(e(U),{variant:"destructive",size:"sm",onClick:G=>R(t.id),disabled:e(c).processing},{default:o(()=>[a(e(oe),{class:"h-4 w-4 mr-1"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),u("div",de,[a(e(U),{variant:"outline",onClick:s[2]||(s[2]=t=>n.value=!1)},{default:o(()=>s[15]||(s[15]=[r("Fechar")])),_:1,__:[15]})])]),_:1})]),_:1},8,["open"]))}};export{he as default};
